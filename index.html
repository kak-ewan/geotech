<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Location-Based AR Android</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

    <!-- A-Frame & AR.js v3 -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.min.js"></script>

    <!-- Look-at component -->
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
      }
      #start-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 25px;
        font-size: 18px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        z-index: 9999;
      }
      #status {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.6);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <button id="start-btn">Mulai Jelajah</button>
    <div id="status">Menunggu izin...</div>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      device-orientation-permission-ui="enabled: false"
    >
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      const startBtn = document.getElementById("start-btn");
      const statusBox = document.getElementById("status");
      const scene = document.querySelector("a-scene");

      // Daftar objek contoh
      const places = [
        { name: "Monas", lat: -6.175392, lon: 106.827153 },
        { name: "Bundaran HI", lat: -6.193056, lon: 106.820556 }
      ];

      function addPlacesToScene() {
        places.forEach((place) => {
          const text = document.createElement("a-text");
          text.setAttribute("value", place.name);
          text.setAttribute("look-at", "[gps-camera]");
          text.setAttribute("scale", "10 10 10");
          text.setAttribute("align", "center");
          text.setAttribute("gps-entity-place", `latitude: ${place.lat}; longitude: ${place.lon}`);
          scene.appendChild(text);
        });
      }

      function requestPermissionsAndStart() {
        // Android Chrome: minta izin geolokasi
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              statusBox.innerText = "Lokasi diterima. Menampilkan AR...";
              addPlacesToScene();
              startBtn.style.display = "none";
            },
            (err) => {
              if (err.code === err.PERMISSION_DENIED) {
                statusBox.innerText = "Izin lokasi dibutuhkan!";
              } else {
                statusBox.innerText = "Gagal mendapatkan lokasi.";
              }
            },
            { enableHighAccuracy: true, timeout: 15000 }
          );
        } else {
          statusBox.innerText = "Browser tidak mendukung GPS.";
        }

        // Kompas: Android biasanya langsung jalan, tapi kita pastikan event listener aktif
        if (typeof DeviceOrientationEvent !== "undefined" && typeof DeviceOrientationEvent.requestPermission === "function") {
          // iOS only, Android skip
          DeviceOrientationEvent.requestPermission().catch(console.warn);
        }
      }

      startBtn.addEventListener("click", requestPermissionsAndStart);
    </script>
  </body>
</html>
