<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Lokasi - Dinamis dari CSV</title>
    
    <!-- A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    
    <!-- CSV Parser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; font-family: sans-serif; }
      #loading {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px 15px;
        border-radius: 8px;
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div id="loading">üì° Memuat lokasi dari spreadsheet...</div>

    <a-scene
      embedded
      arjs="sourceType: webcam; gpsMinAccuracy: 100; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      vr-mode-ui="enabled: false"
    >
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSCPrAyjTP4O7lSWJnouA4Ysnd5U88mcM-dWyJG0Nv9eWOA3yVKrGJ1-5G_QDdEcTNpwn0F5XbzeUJh/pub?output=csv";
      
      // Default model if not provided
      const DEFAULT_MODEL = "https://cdn.glitch.global/94b64d3b-9cd0-4d73-bf40-c27c889c2748/marker.glb?v=1691549132930";

      fetch(CSV_URL)
        .then(response => response.text())
        .then(csvText => {
          Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              const places = results.data;
              const scene = document.querySelector("a-scene");

              places.forEach(place => {
                const lat = parseFloat(place.latitude);
                const lon = parseFloat(place.longitude);
                const name = place.name || "Tanpa Nama";
                const desc = place.description || "";
                const modelUrl = place.model || DEFAULT_MODEL;

                // Buat model 3D
                const model = document.createElement("a-entity");
                model.setAttribute("gps-entity-place", `latitude: ${lat}; longitude: ${lon}`);
                model.setAttribute("gltf-model", modelUrl);
                model.setAttribute("scale", "5 5 5");
                model.setAttribute("look-at", "[gps-camera]");

                // Buat teks nama/deskripsi di atas model
                const text = document.createElement("a-text");
                text.setAttribute("value", `${name}\n${desc}`);
                text.setAttribute("align", "center");
                text.setAttribute("color", "#FFD700");
                text.setAttribute("position", "0 3 0");
                text.setAttribute("scale", "5 5 5");
                text.setAttribute("look-at", "[gps-camera]");

                model.appendChild(text);
                scene.appendChild(model);
              });

              document.getElementById("loading").style.display = "none";
            }
          });
        })
        .catch(error => {
          document.getElementById("loading").innerText = "‚ùå Gagal memuat data CSV.";
          console.error("CSV load error:", error);
        });
    </script>
  </body>
</html>
